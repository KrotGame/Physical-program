import streamlit as st
import numpy as np
import plotly.graph_objects as go

st.title("üí° –°–∏–º—É–ª—è—Ç–æ—Ä –¥–æ—Å–ª—ñ–¥—É –§—Ä–∞–Ω–∫–∞-–ì–µ—Ä—Ü–∞")
st.write("""
–î–µ–º–æ–Ω—Å—Ç—Ä—É—î, —è–∫ —Å—Ç—Ä—É–º (I) –≤ —Ç—Ä—É–±—Ü—ñ, –Ω–∞–ø–æ–≤–Ω–µ–Ω—ñ–π –ø–∞—Ä–∞–º–∏ —Ä—Ç—É—Ç—ñ, 
–∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –ø—Ä–∏—Å–∫–æ—Ä—é—é—á–æ—ó –Ω–∞–ø—Ä—É–≥–∏ (V).
–†—ñ–∑–∫—ñ –ø–∞–¥—ñ–Ω–Ω—è —Å—Ç—Ä—É–º—É –≤—ñ–¥–±—É–≤–∞—é—Ç—å—Å—è, –∫–æ–ª–∏ –µ–ª–µ–∫—Ç—Ä–æ–Ω–∏ –¥–æ—Å—è–≥–∞—é—Ç—å –µ–Ω–µ—Ä–≥—ñ—ó, 
–¥–æ—Å—Ç–∞—Ç–Ω—å–æ—ó –¥–ª—è –Ω–µ–ø—Ä—É–∂–Ω–æ–≥–æ –∑—ñ—Ç–∫–Ω–µ–Ω–Ω—è –∑ –∞—Ç–æ–º–∞–º–∏ —Ä—Ç—É—Ç—ñ (4.9 –µ–í).
""")

# --- –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ ---
st.sidebar.header("–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ —Å–∏–º—É–ª—è—Ü—ñ—ó")
V_ex_eV = st.sidebar.number_input(
    "–ï–Ω–µ—Ä–≥—ñ—è –∑–±—É–¥–∂–µ–Ω–Ω—è (E_ex), –µ–í", 
    min_value=1.0, max_value=10.0, value=4.9, step=0.1,
    help="–î–ª—è —Ä—Ç—É—Ç—ñ (Hg) —Ü–µ 4.9 –µ–í. –î–ª—è –Ω–µ–æ–Ω—É (Ne) - –±–ª–∏–∑—å–∫–æ 18.7 –µ–í."
)

V_max = st.sidebar.slider(
    "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –Ω–∞–ø—Ä—É–≥–∞ (V_max), –í–æ–ª—å—Ç", 
    min_value=10.0, max_value=50.0, value=30.0, step=1.0
)

# --- –†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∞ –º–æ–¥–µ–ª—å ---
# –°—Ç–≤–æ—Ä—é—î–º–æ 500 —Ç–æ—á–æ–∫ –Ω–∞–ø—Ä—É–≥–∏
V = np.linspace(0.01, V_max, 500)

# –°–ø—Ä–æ—â–µ–Ω–∞ –º–æ–¥–µ–ª—å —Å—Ç—Ä—É–º—É.
# –¶–µ –Ω–µ —î —Å—É–≤–æ—Ä–∏–º —Ñ—ñ–∑–∏—á–Ω–∏–º —Ä–æ–∑–≤'—è–∑–∫–æ–º, –∞ –≤—ñ–∑—É–∞–ª—å–Ω–æ—é –º–æ–¥–µ–ª–ª—é,
# —â–æ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –µ—Ñ–µ–∫—Ç.

# 1. –ë–∞–∑–æ–≤–∏–π —Å—Ç—Ä—É–º, —â–æ –ø–æ–≤—ñ–ª—å–Ω–æ —Ä–æ—Å—Ç–µ (—è–∫ —É –≤–∞–∫—É—É–º–Ω—ñ–π –ª–∞–º–ø—ñ)
I_base = V**0.1

# 2. "–ö–æ–ª–∏–≤–∞–Ω–Ω—è" —Å—Ç—Ä—É–º—É, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ –Ω–µ–ø—Ä—É–∂–Ω–∏–º–∏ –∑—ñ—Ç–∫–Ω–µ–Ω–Ω—è–º–∏.
# V % V_ex –¥–∞—î –Ω–∞–º "–∑–∞–ª–∏—à–∫–æ–≤—É" –Ω–∞–ø—Ä—É–≥—É –ø—ñ—Å–ª—è –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –∑—ñ—Ç–∫–Ω–µ–Ω–Ω—è.
# –ö–æ–ª–∏ V = V_ex, 4.9 % 4.9 = 0 -> —Å—Ç—Ä—É–º –ø–∞–¥–∞—î.
# –ö–æ–ª–∏ V = 4.8, 4.8 % 4.9 = 4.8 -> —Å—Ç—Ä—É–º –≤–∏—Å–æ–∫–∏–π.
I_oscillation = (V % V_ex_eV)**1.5

# –°—É–º–∞—Ä–Ω–∏–π —Å—Ç—Ä—É–º (–∑ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∞–º–∏ –¥–ª—è –≥–∞—Ä–Ω–æ–≥–æ –≤–∏–≥–ª—è–¥—É)
I = I_base + I_oscillation / (V_ex_eV) # –ù–æ—Ä–º—É—î–º–æ

# --- –ì—Ä–∞—Ñ—ñ–∫ ---
st.header("–ì—Ä–∞—Ñ—ñ–∫ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —Å—Ç—Ä—É–º—É –≤—ñ–¥ –Ω–∞–ø—Ä—É–≥–∏ I(V)")
fig = go.Figure()

fig.add_trace(go.Scatter(
    x=V, y=I, 
    mode='lines',
    name='–°—Ç—Ä—É–º (I)',
    line=dict(color='royalblue', width=3)
))

# –î–æ–¥–∞—î–º–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ñ –ª—ñ–Ω—ñ—ó, –¥–µ –æ—á—ñ–∫—É—é—Ç—å—Å—è –ø—ñ–∫–∏
peak_voltages = np.arange(V_ex_eV, V_max + V_ex_eV, V_ex_eV)
for v_peak in peak_voltages:
    fig.add_vline(
        x=v_peak, 
        line_width=2, 
        line_dash="dash", 
        line_color="red",
        annotation_text=f"n={int(v_peak/V_ex_eV)} ({v_peak:.1f} V)",
        annotation_position="top left"
    )

fig.update_layout(
    title="–í–æ–ª—å—Ç-–∞–º–ø–µ—Ä–Ω–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ (–í–ê–•)",
    xaxis_title="–ü—Ä–∏—Å–∫–æ—Ä—é—é—á–∞ –Ω–∞–ø—Ä—É–≥–∞ (V), –í–æ–ª—å—Ç",
    yaxis_title="–°—Ç—Ä—É–º (I), —É–º–æ–≤–Ω—ñ –æ–¥–∏–Ω–∏—Ü—ñ",
    height=500
)
st.plotly_chart(fig, use_container_width=True)
st.info(f"–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —è–∫ —Å—Ç—Ä—É–º —Ä—ñ–∑–∫–æ –ø–∞–¥–∞—î **–æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è** –∫–æ–∂–Ω–æ—ó —á–µ—Ä–≤–æ–Ω–æ—ó –ª—ñ–Ω—ñ—ó (–∫—Ä–∞—Ç–Ω–∏—Ö {V_ex_eV} –í), –¥–µ –≤—ñ–¥–±—É–≤–∞—é—Ç—å—Å—è –º–∞—Å–æ–≤—ñ –Ω–µ–ø—Ä—É–∂–Ω—ñ –∑—ñ—Ç–∫–Ω–µ–Ω–Ω—è.")